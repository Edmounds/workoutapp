<!-- profile.wxml -->
<view class="profile-container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="profile-header card">
    <view class="user-info">
      <view class="user-avatar">
        <!-- ä½¿ç”¨æ–‡å­—å¤´åƒæ›¿ä»£å›¾ç‰‡ -->
        <text class="avatar-text">{{userInfo.username ? userInfo.username[0] : 'U'}}</text>
      </view>
      <view class="user-details">
        <text class="user-name">{{userInfo.username || 'ç”¨æˆ·å'}}</text>
        <text class="user-level">{{userInfo.level || 'åˆçº§è·‘è€…'}}</text>
      </view>
    </view>
    <view class="user-stats">
      <view class="stat-item">
        <text class="stat-value">{{userInfo.total_workouts || 0}}</text>
        <text class="stat-label">æ€»è¿åŠ¨æ¬¡æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{userInfo.total_distance || 0}}km</text>
        <text class="stat-label">æ€»é‡Œç¨‹</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{formattedDuration}}</text>
        <text class="stat-label">æ€»æ—¶é•¿</text>
      </view>
    </view>
  </view>
  
  <!-- ä¸ªäººä¿¡æ¯è®¾ç½® -->
  <view class="profile-section card">
    <view class="section-header">
      <text class="section-title">ä¸ªäººä¿¡æ¯</text>
      <text class="edit-btn" bindtap="editProfile">ç¼–è¾‘</text>
    </view>
    <view class="info-list">
      <view class="info-item">
        <text class="info-label">æ€§åˆ«</text>
        <text class="info-value">{{userInfo.gender === 1 ? 'ç”·' : userInfo.gender === 2 ? 'å¥³' : 'æœªè®¾ç½®'}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">å¹´é¾„</text>
        <text class="info-value">{{userInfo.age || '--'}} å²</text>
      </view>
      <view class="info-item">
        <text class="info-label">èº«é«˜</text>
        <text class="info-value">{{userInfo.height || '--'}} cm</text>
      </view>
      <view class="info-item">
        <text class="info-label">ä½“é‡</text>
        <text class="info-value">{{userInfo.weight || '--'}} kg</text>
      </view>
      <view class="info-item">
        <text class="info-label">BMI</text>
        <text class="info-value">{{bmi || '--'}}</text>
      </view>
    </view>
  </view>

  <!-- æˆå°±å¡ç‰‡ -->
  <view class="profile-section card">
    <view class="section-header">
      <text class="section-title">æˆ‘çš„æˆå°±</text>
    </view>
    <view class="achievement-list" wx:if="{{achievements.length > 0}}">
      <view class="achievement-item" wx:for="{{achievements}}" wx:key="id">
        <view class="achievement-icon">
          <text>ğŸ†</text>
        </view>
        <view class="achievement-details">
          <text class="achievement-title">{{item.title}}</text>
          <text class="achievement-desc">{{item.description}}</text>
          <text class="achievement-date">{{item.date}}</text>
        </view>
      </view>
    </view>
    <view class="no-data" wx:else>
      <text>æš‚æ— æˆå°±è®°å½•</text>
    </view>
  </view>

  <!-- è®¾ç½®åˆ—è¡¨ -->
  <view class="profile-section card">
    <view class="section-header">
      <text class="section-title">è®¾ç½®</text>
    </view>
    <view class="settings-list">
      <view class="settings-item" bindtap="navigateToSettings">
        <text class="settings-label">é€šç”¨è®¾ç½®</text>
        <text class="settings-arrow">></text>
      </view>
      <view class="settings-item" bindtap="navigateToPrivacy">
        <text class="settings-label">éšç§æ”¿ç­–</text>
        <text class="settings-arrow">></text>
      </view>
      <view class="settings-item" bindtap="navigateToAbout">
        <text class="settings-label">å…³äºæˆ‘ä»¬</text>
        <text class="settings-arrow">></text>
      </view>
      <view class="settings-item" bindtap="handleLogout">
        <text class="settings-label logout">é€€å‡ºç™»å½•</text>
      </view>
    </view>
  </view>

  <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
  <view class="app-version">
    <text>ç‰ˆæœ¬ 1.0.0</text>
  </view>
</view>

<!-- ç¼–è¾‘ä¸ªäººä¿¡æ¯å¼¹çª— -->
<view class="edit-profile-modal" wx:if="{{showEditModal}}">
  <view class="modal-mask" bindtap="closeEditModal"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">ç¼–è¾‘ä¸ªäººä¿¡æ¯</text>
      <text class="modal-close" bindtap="closeEditModal">Ã—</text>
    </view>
    <view class="modal-body">
      <view class="form-group">
        <text class="form-label">æ€§åˆ«</text>
        <radio-group class="radio-group" bindchange="genderChange">
          <label class="radio">
            <radio value="1" checked="{{userInfo.gender === 1}}" /> ç”·
          </label>
          <label class="radio">
            <radio value="2" checked="{{userInfo.gender === 2}}" /> å¥³
          </label>
        </radio-group>
      </view>
      <view class="form-group">
        <text class="form-label">å¹´é¾„</text>
        <input type="number" class="form-input" placeholder="è¯·è¾“å…¥å¹´é¾„" value="{{userInfo.age}}" bindinput="ageInput" />
      </view>
      <view class="form-group">
        <text class="form-label">èº«é«˜ (cm)</text>
        <input type="digit" class="form-input" placeholder="è¯·è¾“å…¥èº«é«˜" value="{{userInfo.height}}" bindinput="heightInput" />
      </view>
      <view class="form-group">
        <text class="form-label">ä½“é‡ (kg)</text>
        <input type="digit" class="form-input" placeholder="è¯·è¾“å…¥ä½“é‡" value="{{userInfo.weight}}" bindinput="weightInput" />
      </view>
    </view>
    <view class="modal-footer">
      <button class="btn-cancel" bindtap="closeEditModal">å–æ¶ˆ</button>
      <button class="btn-save" bindtap="saveProfile" loading="{{isSaving}}">ä¿å­˜</button>
    </view>
  </view>
</view>

<!-- åŠ è½½æç¤º -->
<view class="loading-container" wx:if="{{isLoading}}">
  <view class="loading-spinner"></view>
  <text class="loading-text">åŠ è½½ä¸­...</text>
</view> 