import{_ as we,j as ke,r as v,k as ae,w as Ve,o as he,a as c,b as Te,d as Ue,e as q,h as l,u as Se,g as r,i as f,t as D,m as H}from"./index-13a3803f.js";import{f as je,u as Oe,h as Ce}from"./index-ff651f95.js";var $e=typeof global=="object"&&global&&global.Object===Object&&global;const Ie=$e;var ze=typeof self=="object"&&self&&self.Object===Object&&self,De=Ie||ze||Function("return this")();const se=De;var Ee=se.Symbol;const M=Ee;var ue=Object.prototype,Le=ue.hasOwnProperty,Pe=ue.toString,E=M?M.toStringTag:void 0;function Ne(e){var o=Le.call(e,E),d=e[E];try{e[E]=void 0;var g=!0}catch{}var p=Pe.call(e);return g&&(o?e[E]=d:delete e[E]),p}var Me=Object.prototype,Be=Me.toString;function We(e){return Be.call(e)}var Ge="[object Null]",Re="[object Undefined]",re=M?M.toStringTag:void 0;function Ae(e){return e==null?e===void 0?Re:Ge:re&&re in Object(e)?Ne(e):We(e)}function Fe(e){return e!=null&&typeof e=="object"}var qe="[object Symbol]";function He(e){return typeof e=="symbol"||Fe(e)&&Ae(e)==qe}var Ke=/\s/;function Xe(e){for(var o=e.length;o--&&Ke.test(e.charAt(o)););return o}var Je=/^\s+/;function Qe(e){return e&&e.slice(0,Xe(e)+1).replace(Je,"")}function X(e){var o=typeof e;return e!=null&&(o=="object"||o=="function")}var oe=0/0,Ye=/^[-+]0x[0-9a-f]+$/i,Ze=/^0b[01]+$/i,et=/^0o[0-7]+$/i,tt=parseInt;function ie(e){if(typeof e=="number")return e;if(He(e))return oe;if(X(e)){var o=typeof e.valueOf=="function"?e.valueOf():e;e=X(o)?o+"":o}if(typeof e!="string")return e===0?e:+e;e=Qe(e);var d=Ze.test(e);return d||et.test(e)?tt(e.slice(2),d?2:8):Ye.test(e)?oe:+e}var nt=function(){return se.Date.now()};const K=nt;var lt="Expected a function",at=Math.max,rt=Math.min;function ot(e,o,d){var g,p,_,b,u,m,y=0,L=!1,i=!1,h=!0;if(typeof e!="function")throw new TypeError(lt);o=ie(o)||0,X(d)&&(L=!!d.leading,i="maxWait"in d,_=i?at(ie(d.maxWait)||0,o):_,h="trailing"in d?!!d.trailing:h);function k(s){var w=g,T=p;return g=p=void 0,y=s,b=e.apply(T,w),b}function S(s){return y=s,u=setTimeout(j,o),L?k(s):b}function C(s){var w=s-m,T=s-y,N=o-w;return i?rt(N,_-T):N}function x(s){var w=s-m,T=s-y;return m===void 0||w>=o||w<0||i&&T>=_}function j(){var s=K();if(x(s))return P(s);u=setTimeout(j,C(s))}function P(s){return u=void 0,h&&g?k(s):(g=p=void 0,b)}function B(){u!==void 0&&clearTimeout(u),y=0,g=m=p=u=void 0}function W(){return u===void 0?b:P(K())}function $(){var s=K(),w=x(s);if(g=arguments,p=this,m=s,w){if(u===void 0)return S(m);if(i)return clearTimeout(u),u=setTimeout(j,o),k(m)}return u===void 0&&(u=setTimeout(j,o)),b}return $.cancel=B,$.flush=W,$}const it={class:"users-view pa-4"},st={class:"d-flex align-center mb-6"},ut={class:"d-flex justify-end"},dt={__name:"UsersView",setup(e){const o=ke(),d=v(!1),g=v([]),p=v(0),_=v(1),b=v(20),u=v(""),m=v(!1),y=v(!0),L=v(null),i=ae({id:null,username:"",gender:null,age:null,height:null,weight:null,level:null}),h=v(!1),k=v(!1),S=v(null),C=v(!1),x=ae({show:!1,text:"",color:"success"}),j=[{title:"ID",key:"id",width:"80px"},{title:"用户名",key:"username"},{title:"性别",key:"gender",width:"100px",align:"center"},{title:"年龄",key:"age",width:"80px",align:"center"},{title:"身高(cm)",key:"height",width:"100px",align:"center"},{title:"体重(kg)",key:"weight",width:"100px",align:"center"},{title:"等级",key:"level",width:"120px",align:"center"},{title:"运动次数",key:"total_workouts",width:"120px",align:"center"},{title:"注册时间",key:"created_at",width:"180px"},{title:"操作",key:"actions",sortable:!1,width:"150px",align:"end"}],P=[{text:"未设置",value:0},{text:"男",value:1},{text:"女",value:2}],B=[{text:"初学者",value:"beginner"},{text:"中级",value:"intermediate"},{text:"高级",value:"advanced"}],W={required:n=>!!n||"此字段为必填项"};function $(n){switch(n){case 1:return"男";case 2:return"女";default:return"未设置"}}function s(n){switch(n){case 1:return"blue";case 2:return"pink";default:return"grey"}}function w(n){switch(n){case"beginner":return"初学者";case"intermediate":return"中级";case"advanced":return"高级";default:return n}}function T(n){switch(n){case"beginner":return"green";case"intermediate":return"orange";case"advanced":return"red";default:return"grey"}}function N(n){return n?new Date(n).toLocaleString("zh-CN"):""}async function O(){d.value=!0;try{const n={page:_.value,size:b.value,keyword:u.value},t=await je(n);t.code===200?(g.value=t.data.users,p.value=t.data.total):V(t.message||"获取用户列表失败","error")}catch(n){console.error("加载用户列表错误:",n),V("加载用户列表失败","error")}finally{d.value=!1}}function de(n){_.value=n,O()}function ce(n){b.value=n,O()}const J=ot(()=>{_.value=1,O()},500);function fe(n){o.push(`/users/${n}`)}function me(n){Object.assign(i,{id:n.id,username:n.username,gender:n.gender,age:n.age,height:n.height,weight:n.weight,level:n.level}),m.value=!0}function ve(){m.value=!1}async function ge(){if(y.value){h.value=!0;try{const n=await Oe(i.id,i);n.code===200?(V("用户信息更新成功","success"),m.value=!1,O()):V(n.message||"用户信息更新失败","error")}catch(n){console.error("更新用户信息错误:",n),V("更新用户信息失败","error")}finally{h.value=!1}}}function pe(n){S.value=n,k.value=!0}async function _e(){if(S.value){C.value=!0;try{const n=await Ce(S.value.id);n.code===200?(V("用户删除成功","success"),k.value=!1,O()):V(n.message||"用户删除失败","error")}catch(n){console.error("删除用户错误:",n),V("删除用户失败","error")}finally{C.value=!1}}}function V(n,t="success"){x.text=n,x.color=t,x.show=!0}return Ve(u,()=>{J()}),he(()=>{O()}),(n,t)=>{const G=c("v-spacer"),I=c("v-text-field"),Q=c("v-chip"),R=c("v-icon"),U=c("v-btn"),A=c("v-tooltip"),be=c("v-data-table"),F=c("v-card"),Y=c("v-card-title"),Z=c("v-select"),ye=c("v-form"),ee=c("v-card-text"),te=c("v-card-actions"),ne=c("v-dialog"),xe=c("v-snackbar");return Te(),Ue("div",it,[q("div",st,[t[12]||(t[12]=q("h1",{class:"text-h4"},"用户管理",-1)),l(G),l(I,{modelValue:u.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>u.value=a),Se(J)],"prepend-inner-icon":"mdi-magnify",label:"搜索用户",variant:"outlined",density:"compact","hide-details":"",class:"search-field mx-2",style:{"max-width":"300px"}},null,8,["modelValue","onUpdate:modelValue"])]),l(F,{class:"elevation-3",rounded:"lg"},{default:r(()=>[l(be,{headers:j,items:g.value,"items-per-page":b.value,loading:d.value,"server-items-length":p.value,page:_.value,"items-per-page-options":[10,20,50],"onUpdate:page":de,"onUpdate:itemsPerPage":ce,class:"users-table"},{"item.gender":r(({item:a})=>[l(Q,{color:s(a.gender),size:"small",class:"text-capitalize"},{default:r(()=>[f(D($(a.gender)),1)]),_:2},1032,["color"])]),"item.level":r(({item:a})=>[l(Q,{color:T(a.level),size:"small",class:"text-capitalize"},{default:r(()=>[f(D(w(a.level)),1)]),_:2},1032,["color"])]),"item.created_at":r(({item:a})=>[f(D(N(a.created_at)),1)]),"item.actions":r(({item:a})=>[q("div",ut,[l(A,{text:"查看详情"},{activator:r(({props:z})=>[l(U,H({icon:"",variant:"text",color:"info",size:"small"},z,{onClick:le=>fe(a.id)}),{default:r(()=>[l(R,null,{default:r(()=>t[13]||(t[13]=[f("mdi-eye")])),_:1,__:[13]})]),_:2},1040,["onClick"])]),_:2},1024),l(A,{text:"编辑用户"},{activator:r(({props:z})=>[l(U,H({icon:"",variant:"text",color:"primary",size:"small"},z,{onClick:le=>me(a)}),{default:r(()=>[l(R,null,{default:r(()=>t[14]||(t[14]=[f("mdi-pencil")])),_:1,__:[14]})]),_:2},1040,["onClick"])]),_:2},1024),l(A,{text:"删除用户"},{activator:r(({props:z})=>[l(U,H({icon:"",variant:"text",color:"error",size:"small"},z,{onClick:le=>pe(a)}),{default:r(()=>[l(R,null,{default:r(()=>t[15]||(t[15]=[f("mdi-delete")])),_:1,__:[15]})]),_:2},1040,["onClick"])]),_:2},1024)])]),_:1},8,["items","items-per-page","loading","server-items-length","page"])]),_:1}),l(ne,{modelValue:m.value,"onUpdate:modelValue":t[8]||(t[8]=a=>m.value=a),"max-width":"600px"},{default:r(()=>[l(F,null,{default:r(()=>[l(Y,{class:"text-h5 pa-4"},{default:r(()=>t[16]||(t[16]=[f(" 编辑用户信息 ")])),_:1,__:[16]}),l(ee,null,{default:r(()=>[l(ye,{ref_key:"form",ref:L,modelValue:y.value,"onUpdate:modelValue":t[7]||(t[7]=a=>y.value=a)},{default:r(()=>[l(I,{modelValue:i.username,"onUpdate:modelValue":t[1]||(t[1]=a=>i.username=a),label:"用户名",rules:[W.required],variant:"outlined",class:"mb-2"},null,8,["modelValue","rules"]),l(Z,{modelValue:i.gender,"onUpdate:modelValue":t[2]||(t[2]=a=>i.gender=a),items:P,"item-title":"text","item-value":"value",label:"性别",variant:"outlined",class:"mb-2"},null,8,["modelValue"]),l(I,{modelValue:i.age,"onUpdate:modelValue":t[3]||(t[3]=a=>i.age=a),modelModifiers:{number:!0},label:"年龄",type:"number",variant:"outlined",class:"mb-2"},null,8,["modelValue"]),l(I,{modelValue:i.height,"onUpdate:modelValue":t[4]||(t[4]=a=>i.height=a),modelModifiers:{number:!0},label:"身高 (cm)",type:"number",variant:"outlined",class:"mb-2"},null,8,["modelValue"]),l(I,{modelValue:i.weight,"onUpdate:modelValue":t[5]||(t[5]=a=>i.weight=a),modelModifiers:{number:!0},label:"体重 (kg)",type:"number",variant:"outlined",class:"mb-2"},null,8,["modelValue"]),l(Z,{modelValue:i.level,"onUpdate:modelValue":t[6]||(t[6]=a=>i.level=a),items:B,"item-title":"text","item-value":"value",label:"用户等级",variant:"outlined",class:"mb-2"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(te,{class:"pa-4"},{default:r(()=>[l(G),l(U,{color:"grey-darken-1",variant:"text",onClick:ve},{default:r(()=>t[17]||(t[17]=[f("取消")])),_:1,__:[17]}),l(U,{color:"primary",disabled:!y.value,onClick:ge,loading:h.value},{default:r(()=>t[18]||(t[18]=[f("保存")])),_:1,__:[18]},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ne,{modelValue:k.value,"onUpdate:modelValue":t[10]||(t[10]=a=>k.value=a),"max-width":"450px"},{default:r(()=>[l(F,null,{default:r(()=>[l(Y,{class:"text-h5 pa-4"},{default:r(()=>t[19]||(t[19]=[f(" 确认删除 ")])),_:1,__:[19]}),l(ee,null,{default:r(()=>{var a;return[f(' 您确定要删除用户 "'+D((a=S.value)==null?void 0:a.username)+'" 吗？此操作无法撤销。 ',1)]}),_:1}),l(te,{class:"pa-4"},{default:r(()=>[l(G),l(U,{color:"grey-darken-1",variant:"text",onClick:t[9]||(t[9]=a=>k.value=!1)},{default:r(()=>t[20]||(t[20]=[f("取消")])),_:1,__:[20]}),l(U,{color:"error",onClick:_e,loading:C.value},{default:r(()=>t[21]||(t[21]=[f("删除")])),_:1,__:[21]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(xe,{modelValue:x.show,"onUpdate:modelValue":t[11]||(t[11]=a=>x.show=a),color:x.color,timeout:"3000",location:"top"},{default:r(()=>[f(D(x.text),1)]),_:1},8,["modelValue","color"])])}}},mt=we(dt,[["__scopeId","data-v-39b0929b"]]);export{mt as default};
