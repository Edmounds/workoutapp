import{u as it,i as dt,a as ut,b as ct,c as vt,d as mt,H as k}from"./index.esm.min-9d6ac37d.js";import{k as pt,b as _t,l as ft,d as yt,m as gt,n as xt}from"./index-4b301e06.js";import{_ as wt,r as i,c as g,w as bt,o as kt,a as d,b as r,d as _,e as s,h as e,g as a,f as p,F as Vt,s as H,i as v,t as N,u as V}from"./index-f43b9162.js";import{i as Dt,a as St}from"./install-a518cc38.js";import{i as ht}from"./install-d1764aa1.js";const zt={class:"statistics-view pa-4"},At={class:"text-h5 font-weight-bold"},Ut={class:"text-h5 font-weight-bold"},Ot={class:"text-h5 font-weight-bold"},Tt={class:"text-h5 font-weight-bold"},$t={key:1,class:"text-center pt-10"},Rt={key:1,class:"text-center pt-10"},Wt={key:1,class:"text-center pt-10"},Ct={key:1,class:"text-center pt-10"},Nt={key:1,class:"text-center pt-10"},Bt={__name:"StatisticsView",setup(Ft){it([dt,ut,Dt,ht,ct,vt,mt,St]);const B=i(!0),x=i("last30days"),D=i(""),S=i(""),w=i({}),h=i([]),z=i([]),F=i("month"),A=i("workouts"),U=i([]),M=i("month"),O=i([]),P=i("month"),T=i([]),K=[{title:"最近7天",value:"last7days"},{title:"最近30天",value:"last30days"},{title:"最近90天",value:"last90days"},{title:"今年",value:"thisyear"},{title:"自定义",value:"custom"}],G=g(()=>x.value==="custom");function Q(l){return l?`${Math.floor(l/60)}小时${l%60}分钟`:"0小时"}function X(){const l=new Date;let t=new Date,n=new Date;switch(x.value){case"last7days":t.setDate(l.getDate()-7);break;case"last30days":t.setDate(l.getDate()-30);break;case"last90days":t.setDate(l.getDate()-90);break;case"thisyear":t=new Date(l.getFullYear(),0,1);break;case"custom":D.value&&(t=new Date(D.value)),S.value&&(n=new Date(S.value));break}return{startDate:t.toISOString().split("T")[0],endDate:n.toISOString().split("T")[0]}}function I(){Y()}async function Y(){B.value=!0;try{const{startDate:l,endDate:t}=X();await Z(l,t),await tt(l,t),await et(),await L(),await j(),await q()}catch(l){console.error("加载统计数据错误:",l)}finally{B.value=!1}}async function Z(l,t){try{const n={};l&&(n.start_date=l),t&&(n.end_date=t);const o=await pt(n);o.code===200&&(w.value=o.data)}catch(n){console.error("加载运动总量数据错误:",n)}}async function tt(l,t){try{const n={};l&&(n.start_date=l),t&&(n.end_date=t);const o=await _t(n);o.code===200&&(h.value=o.data)}catch(n){console.error("加载运动类型分布错误:",n)}}async function et(){try{const l=await ft();l.code===200&&(z.value=l.data)}catch(l){console.error("加载年龄分布错误:",l)}}async function L(){try{const l={period:F.value,metric:A.value,count:12},t=await yt(l);t.code===200&&(U.value=t.data.data)}catch(l){console.error("加载运动趋势错误:",l)}}async function j(){try{const l={interval:M.value,count:12},t=await gt(l);t.code===200&&(O.value=t.data.stats)}catch(l){console.error("加载注册统计错误:",l)}}async function q(){try{const l={interval:P.value,count:12},t=await xt(l);t.code===200&&(T.value=t.data.stats)}catch(l){console.error("加载活跃用户统计错误:",l)}}const at=g(()=>({tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center",data:h.value.map(l=>l.workout_type||"未分类")},series:[{name:"运动类型",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:h.value.map(l=>({value:l.count,name:l.workout_type||"未分类"}))}]})),lt=g(()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:z.value.map(l=>l.range)},yAxis:{type:"value",name:"用户数"},series:[{name:"用户数",type:"bar",data:z.value.map(l=>l.count),itemStyle:{borderRadius:[4,4,0,0]}}]})),ot=g(()=>{const l=A.value;let t,n;return l==="workouts"?(t="运动次数",n="次数"):l==="distance"?(t="运动距离",n="距离(km)"):(t="运动时长",n="时长(分钟)"),{tooltip:{trigger:"axis"},xAxis:{type:"category",data:U.value.map(o=>o.date),boundaryGap:!1},yAxis:{type:"value",name:n},series:[{name:t,type:"line",data:U.value.map(o=>o.value),areaStyle:{opacity:.3},smooth:!0,lineStyle:{width:3},symbol:"circle",symbolSize:8}]}}),st=g(()=>({tooltip:{trigger:"axis"},xAxis:{type:"category",data:O.value.map(l=>l.date),boundaryGap:!1},yAxis:{type:"value",name:"新注册用户数"},series:[{name:"新注册用户",type:"line",data:O.value.map(l=>l.count),areaStyle:{opacity:.3},smooth:!0,lineStyle:{width:3},symbol:"circle",symbolSize:8}]})),nt=g(()=>({tooltip:{trigger:"axis"},xAxis:{type:"category",data:T.value.map(l=>l.date),boundaryGap:!1},yAxis:{type:"value",name:"活跃用户数"},series:[{name:"活跃用户",type:"bar",data:T.value.map(l=>l.active_users),itemStyle:{borderRadius:[4,4,0,0]}}]}));return bt(x,l=>{l!=="custom"&&I()}),kt(()=>{Y()}),(l,t)=>{const n=d("v-select"),o=d("v-col"),J=d("v-text-field"),c=d("v-btn"),f=d("v-row"),y=d("v-card-text"),m=d("v-card"),rt=d("v-progress-circular"),$=d("v-icon"),R=d("v-avatar"),W=d("v-card-item"),b=d("v-card-title"),E=d("v-spacer"),C=d("v-btn-toggle");return r(),_("div",zt,[t[32]||(t[32]=s("h1",{class:"text-h4 mb-6"},"运动数据统计",-1)),e(m,{class:"filter-card mb-6 elevation-3",rounded:"lg"},{default:a(()=>[e(y,null,{default:a(()=>[e(f,null,{default:a(()=>[e(o,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(n,{modelValue:x.value,"onUpdate:modelValue":[t[0]||(t[0]=u=>x.value=u),I],items:K,label:"日期范围",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),G.value?(r(),p(o,{key:0,cols:"12",sm:"6",md:"3"},{default:a(()=>[e(J,{modelValue:D.value,"onUpdate:modelValue":t[1]||(t[1]=u=>D.value=u),label:"开始日期",type:"date",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})):H("",!0),G.value?(r(),p(o,{key:1,cols:"12",sm:"6",md:"3"},{default:a(()=>[e(J,{modelValue:S.value,"onUpdate:modelValue":t[2]||(t[2]=u=>S.value=u),label:"结束日期",type:"date",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})):H("",!0),G.value?(r(),p(o,{key:2,cols:"12",sm:"6",md:"3",class:"d-flex align-center"},{default:a(()=>[e(c,{color:"primary",onClick:I,class:"ml-auto"},{default:a(()=>t[7]||(t[7]=[v("应用筛选")])),_:1,__:[7]})]),_:1})):H("",!0)]),_:1})]),_:1})]),_:1}),B.value?(r(),p(f,{key:0},{default:a(()=>[e(o,{cols:"12",class:"text-center"},{default:a(()=>[e(rt,{indeterminate:"",color:"primary",size:"60"})]),_:1})]),_:1})):(r(),_(Vt,{key:1},[e(f,{class:"mb-6"},{default:a(()=>[e(o,{cols:"12",sm:"6",lg:"3"},{default:a(()=>[e(m,{class:"stat-card elevation-3",rounded:"lg"},{default:a(()=>[e(W,null,{prepend:a(()=>[e(R,{rounded:"",color:"primary",variant:"tonal",class:"mr-3"},{default:a(()=>[e($,{size:"24",icon:"mdi-run"})]),_:1})]),default:a(()=>[s("div",null,[s("div",At,N(w.value.total_workouts||0),1),t[8]||(t[8]=s("div",{class:"text-subtitle-2 text-grey"},"总运动次数",-1))])]),_:1})]),_:1})]),_:1}),e(o,{cols:"12",sm:"6",lg:"3"},{default:a(()=>[e(m,{class:"stat-card elevation-3",rounded:"lg"},{default:a(()=>[e(W,null,{prepend:a(()=>[e(R,{rounded:"",color:"info",variant:"tonal",class:"mr-3"},{default:a(()=>[e($,{size:"24",icon:"mdi-map-marker-distance"})]),_:1})]),default:a(()=>[s("div",null,[s("div",Ut,N(w.value.total_distance||0)+" km",1),t[9]||(t[9]=s("div",{class:"text-subtitle-2 text-grey"},"总运动距离",-1))])]),_:1})]),_:1})]),_:1}),e(o,{cols:"12",sm:"6",lg:"3"},{default:a(()=>[e(m,{class:"stat-card elevation-3",rounded:"lg"},{default:a(()=>[e(W,null,{prepend:a(()=>[e(R,{rounded:"",color:"success",variant:"tonal",class:"mr-3"},{default:a(()=>[e($,{size:"24",icon:"mdi-clock-outline"})]),_:1})]),default:a(()=>[s("div",null,[s("div",Ot,N(Q(w.value.total_duration)),1),t[10]||(t[10]=s("div",{class:"text-subtitle-2 text-grey"},"总运动时长",-1))])]),_:1})]),_:1})]),_:1}),e(o,{cols:"12",sm:"6",lg:"3"},{default:a(()=>[e(m,{class:"stat-card elevation-3",rounded:"lg"},{default:a(()=>[e(W,null,{prepend:a(()=>[e(R,{rounded:"",color:"warning",variant:"tonal",class:"mr-3"},{default:a(()=>[e($,{size:"24",icon:"mdi-account-group"})]),_:1})]),default:a(()=>[s("div",null,[s("div",Tt,N(Math.round(w.value.avg_workouts_per_user)||0),1),t[11]||(t[11]=s("div",{class:"text-subtitle-2 text-grey"},"人均运动次数",-1))])]),_:1})]),_:1})]),_:1})]),_:1}),e(f,null,{default:a(()=>[e(o,{cols:"12",md:"6"},{default:a(()=>[e(m,{class:"elevation-3",height:"400",rounded:"lg"},{default:a(()=>[e(b,{class:"d-flex align-center"},{default:a(()=>t[12]||(t[12]=[s("span",null,"运动类型分布",-1)])),_:1,__:[12]}),e(y,{class:"chart-container"},{default:a(()=>[h.value.length>0?(r(),p(V(k),{key:0,class:"chart",option:at.value,autoresize:""},null,8,["option"])):(r(),_("div",$t,t[13]||(t[13]=[s("p",{class:"text-body-1"},"暂无数据",-1)])))]),_:1})]),_:1})]),_:1}),e(o,{cols:"12",md:"6"},{default:a(()=>[e(m,{class:"elevation-3",height:"400",rounded:"lg"},{default:a(()=>[e(b,{class:"d-flex align-center"},{default:a(()=>t[14]||(t[14]=[s("span",null,"用户年龄分布",-1)])),_:1,__:[14]}),e(y,{class:"chart-container"},{default:a(()=>[z.value.length>0?(r(),p(V(k),{key:0,class:"chart",option:lt.value,autoresize:""},null,8,["option"])):(r(),_("div",Rt,t[15]||(t[15]=[s("p",{class:"text-body-1"},"暂无数据",-1)])))]),_:1})]),_:1})]),_:1})]),_:1}),e(f,{class:"mt-4"},{default:a(()=>[e(o,{cols:"12"},{default:a(()=>[e(m,{class:"elevation-3",height:"400",rounded:"lg"},{default:a(()=>[e(b,{class:"d-flex align-center"},{default:a(()=>[t[22]||(t[22]=s("span",null,"运动数据趋势",-1)),e(E),e(C,{modelValue:F.value,"onUpdate:modelValue":[t[3]||(t[3]=u=>F.value=u),L],mandatory:""},{default:a(()=>[e(c,{value:"week",density:"compact",variant:"text"},{default:a(()=>t[16]||(t[16]=[v("周")])),_:1,__:[16]}),e(c,{value:"month",density:"compact",variant:"text"},{default:a(()=>t[17]||(t[17]=[v("月")])),_:1,__:[17]}),e(c,{value:"year",density:"compact",variant:"text"},{default:a(()=>t[18]||(t[18]=[v("年")])),_:1,__:[18]})]),_:1},8,["modelValue"]),e(C,{modelValue:A.value,"onUpdate:modelValue":[t[4]||(t[4]=u=>A.value=u),L],class:"ml-2",mandatory:""},{default:a(()=>[e(c,{value:"workouts",density:"compact",variant:"text"},{default:a(()=>t[19]||(t[19]=[v("次数")])),_:1,__:[19]}),e(c,{value:"distance",density:"compact",variant:"text"},{default:a(()=>t[20]||(t[20]=[v("距离")])),_:1,__:[20]}),e(c,{value:"duration",density:"compact",variant:"text"},{default:a(()=>t[21]||(t[21]=[v("时长")])),_:1,__:[21]})]),_:1},8,["modelValue"])]),_:1,__:[22]}),e(y,{class:"chart-container"},{default:a(()=>[U.value.length>0?(r(),p(V(k),{key:0,class:"chart",option:ot.value,autoresize:""},null,8,["option"])):(r(),_("div",Wt,t[23]||(t[23]=[s("p",{class:"text-body-1"},"暂无数据",-1)])))]),_:1})]),_:1})]),_:1})]),_:1}),e(f,{class:"mt-4"},{default:a(()=>[e(o,{cols:"12",md:"6"},{default:a(()=>[e(m,{class:"elevation-3",height:"400",rounded:"lg"},{default:a(()=>[e(b,{class:"d-flex align-center"},{default:a(()=>[t[26]||(t[26]=s("span",null,"用户注册趋势",-1)),e(E),e(C,{modelValue:M.value,"onUpdate:modelValue":[t[5]||(t[5]=u=>M.value=u),j],mandatory:""},{default:a(()=>[e(c,{value:"week",density:"compact",variant:"text"},{default:a(()=>t[24]||(t[24]=[v("周")])),_:1,__:[24]}),e(c,{value:"month",density:"compact",variant:"text"},{default:a(()=>t[25]||(t[25]=[v("月")])),_:1,__:[25]})]),_:1},8,["modelValue"])]),_:1,__:[26]}),e(y,{class:"chart-container"},{default:a(()=>[O.value.length>0?(r(),p(V(k),{key:0,class:"chart",option:st.value,autoresize:""},null,8,["option"])):(r(),_("div",Ct,t[27]||(t[27]=[s("p",{class:"text-body-1"},"暂无数据",-1)])))]),_:1})]),_:1})]),_:1}),e(o,{cols:"12",md:"6"},{default:a(()=>[e(m,{class:"elevation-3",height:"400",rounded:"lg"},{default:a(()=>[e(b,{class:"d-flex align-center"},{default:a(()=>[t[30]||(t[30]=s("span",null,"活跃用户趋势",-1)),e(E),e(C,{modelValue:P.value,"onUpdate:modelValue":[t[6]||(t[6]=u=>P.value=u),q],mandatory:""},{default:a(()=>[e(c,{value:"week",density:"compact",variant:"text"},{default:a(()=>t[28]||(t[28]=[v("周")])),_:1,__:[28]}),e(c,{value:"month",density:"compact",variant:"text"},{default:a(()=>t[29]||(t[29]=[v("月")])),_:1,__:[29]})]),_:1},8,["modelValue"])]),_:1,__:[30]}),e(y,{class:"chart-container"},{default:a(()=>[T.value.length>0?(r(),p(V(k),{key:0,class:"chart",option:nt.value,autoresize:""},null,8,["option"])):(r(),_("div",Nt,t[31]||(t[31]=[s("p",{class:"text-body-1"},"暂无数据",-1)])))]),_:1})]),_:1})]),_:1})]),_:1})],64))])}}},Et=wt(Bt,[["__scopeId","data-v-7a0a50dd"]]);export{Et as default};
