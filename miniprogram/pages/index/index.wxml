<!--index.wxml-->
<view class="container">
  <scroll-view scroll-y class="scrollarea" enhanced="true" show-scrollbar="false">
    <!-- 顶部用户运动摘要 -->
    <view class="user-summary">
      <view class="summary-title">运动数据概览</view>
      <view class="stats-container">
        <view class="stat-item">
          <text class="stat-value">{{userStats.totalKm || 0}}</text>
          <text class="stat-label">总公里数</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{userStats.totalCount || 0}}</text>
          <text class="stat-label">总运动次数</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{userStats.totalHours || 0}}</text>
          <text class="stat-label">总运动时长</text>
        </view>
      </view>
    </view>

    <view class="section-title">详细数据</view>
    <view class="grid">
      <!-- 心率折线图 -->
      <view class="card">
        <view class="ec-container">
          <ec-canvas id="heart-line" canvas-id="heart-line" ec="{{ecHeartLine}}" force-use-old-canvas="{{forceUseOldCanvas}}"></ec-canvas>
        </view>
        <text class="label">平均心率：<text class="value">{{avgHeartRate}} bpm</text></text>
      </view>
      <!-- 运动健康指数环形进度条 -->
      <view class="card">
        <view class="ec-container">
          <ec-canvas id="health-circle" canvas-id="health-circle" ec="{{ecHealthCircle}}" force-use-old-canvas="{{forceUseOldCanvas}}"></ec-canvas>
        </view>
        <text class="label">健康指数评分</text>
      </view>
      <!-- 步频折线图 -->
      <view class="card">
        <view class="ec-container">
          <ec-canvas id="step-line" canvas-id="step-line" ec="{{ecStepLine}}" force-use-old-canvas="{{forceUseOldCanvas}}"></ec-canvas>
        </view>
        <text class="label">平均步频：<text class="value">{{avgStepRate}}步/分钟</text></text>
      </view>
      <!-- 运动压力指数环形进度条 -->
      <view class="card">
        <view class="ec-container">
          <ec-canvas id="stress-circle" canvas-id="stress-circle" ec="{{ecStressCircle}}" force-use-old-canvas="{{forceUseOldCanvas}}"></ec-canvas>
        </view>
        <text class="label">压力指数评分</text>
      </view>
      <!-- 配速面积图 -->
      <view class="card">
        <view class="ec-container">
          <ec-canvas id="pace-line" canvas-id="pace-line" ec="{{ecPaceLine}}" force-use-old-canvas="{{forceUseOldCanvas}}"></ec-canvas>
        </view>
        <text class="label">平均配速：<text class="value">{{avgPace}}</text></text>
      </view>
      <!-- 数据列表 -->
      <view class="card">
        <view class="data-list">
          <view class="data-item" wx:for="{{progressList}}" wx:key="index">
            <text class="data-title">{{item.title}}</text>
            <view class="data-value-container">
              <text class="data-value" style="color: {{item.color}}">{{item.value}}</text>
              <text class="data-unit">{{item.unit}}</text>
            </view>
          </view>
        </view>
      </view>
      <!-- 血氧饱和度环形进度条 -->
      <view class="card">
        <view class="ec-container">
          <ec-canvas id="oxygen-circle" canvas-id="oxygen-circle" ec="{{ecOxygenCircle}}" force-use-old-canvas="{{forceUseOldCanvas}}"></ec-canvas>
        </view>
        <text class="label">有氧能力评估</text>
      </view>
      <!-- 本周运动情况柱状图 -->
      <view class="card last-card">
        <view class="ec-container">
          <ec-canvas id="week-bar" canvas-id="week-bar" ec="{{ecWeekBar}}" force-use-old-canvas="{{forceUseOldCanvas}}"></ec-canvas>
        </view>
        <text class="label">本周运动情况</text>
      </view>
    </view>
    
    <!-- AI建议区域 -->
    <view class="advice">
      <text class="section-title">Deepseek AI运动建议</text>
      <text class="advice-content">
        根据您近期的运动数据分析，建议适当提高有氧训练时长，目前您的心率控制较好，步频可以通过短距离冲刺训练提高。建议每周保持4-5次30分钟以上的有氧训练，并加入1-2次力量训练以提高整体运动表现。血氧水平正常，压力指数良好，继续保持现有的休息和恢复策略。
      </text>
    </view>
    
    <!-- 最近训练记录 -->
    <view class="training-history">
      <text class="section-title">最近训练</text>
      <block wx:if="{{recentWorkouts.length > 0}}">
        <t-cell wx:for="{{recentWorkouts}}" wx:key="id"
          title="{{item.workout_type}}" 
          description="{{item.start_time}}"
          note="{{item.duration}}分钟 · {{item.distance}}公里"
          hover
          arrow
        />
      </block>
      <block wx:else>
        <t-cell 
          title="5公里跑步训练" 
          description="2025-04-28 18:30"
          note="27分35秒 · 配速 5分31秒/km"
          hover
          arrow
        />
        <t-cell 
          title="力量训练" 
          description="2025-04-27 20:00"
          note="45分钟 · 核心训练"
          hover
          arrow
        />
      </block>
    </view>
    
    <!-- 下拉刷新提示 -->
    <view class="refresh-tip">下拉刷新获取最新数据</view>
  </scroll-view>
</view>
