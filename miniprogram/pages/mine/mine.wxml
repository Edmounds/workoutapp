<!--pages/mine/mine.wxml-->
<view class="container">
  <!-- 用户信息卡片 -->
  <view class="user-card">
    <!-- 未登录状态 -->
    <view class="user-info" wx:if="{{!isLoggedIn}}">
      <view class="avatar-placeholder"></view>
      <view class="user-details">
        <text class="name">未登录</text>
        <view class="login-btn">
          <button type="primary" size="mini" bindtap="showLogin">点击登录</button>
        </view>
      </view>
    </view>
    
    <!-- 已登录状态 -->
    <view class="user-info" wx:else>
      <image class="avatar" src="{{userInfo.avatarUrl || 'https://example.com/avatar.jpg'}}" />
      <view class="user-details">
        <text class="name">{{userInfo.username || '用户'}}</text>
        <text class="level">运动等级：{{userInfo.level || '业余跑者'}}</text>
        <view class="logout-btn">
          <button type="warn" size="mini" plain bindtap="handleLogout">退出登录</button>
        </view>
      </view>
    </view>
    
    <!-- 运动数据统计 -->
    <view class="stats-container">
      <view class="stat-item">
        <text class="stat-value">{{userSportData.totalWorkouts}}</text>
        <text class="stat-label">总运动次数</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{userSportData.totalDuration}}</text>
        <text class="stat-label">总运动时长</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{userSportData.totalDistance}}</text>
        <text class="stat-label">总公里数</text>
      </view>
    </view>
  </view>

  <!-- 成就徽章区域 -->
  <view class="achievements" wx:if="{{isLoggedIn}}">
    <text class="section-title">成就徽章</text>
    <t-grid column="4" gutter="{{16}}" align="center">
      <t-grid-item wx:for="{{achievements}}" wx:key="id" 
        image="{{item.icon}}" 
        text="{{item.name}}"
        class="{{item.unlocked ? 'achievement-unlocked' : 'achievement-locked'}}" />
    </t-grid>
  </view>

  <!-- 训练历史区域 -->
  <view class="training-history" wx:if="{{isLoggedIn && trainingHistory.length > 0}}">
    <text class="section-title">训练历史</text>
    <t-cell wx:for="{{trainingHistory}}" wx:key="index" 
      title="{{item.type}}" 
      description="{{item.date}}"
      note="{{item.details}}"
      hover
      arrow
      bind:tap="viewTrainingDetail"
      data-index="{{index}}"
    />
  </view>
  
  <!-- 没有训练历史 -->
  <view class="no-data" wx:if="{{isLoggedIn && trainingHistory.length === 0}}">
    <text>暂无训练记录</text>
  </view>
  
  <!-- 未登录提示 -->
  <view class="login-tip" wx:if="{{!isLoggedIn}}">
    <text>登录后查看您的运动数据</text>
  </view>

  <!-- 设置区域 -->
  <view class="settings">
    <text class="section-title">设置</text>
    <view class="setting-item" bindtap="navigateToSettings" data-type="profile">
      <text>个人资料</text>
      <text class="arrow">></text>
    </view>
    <view class="setting-item" bindtap="navigateToSettings" data-type="notification">
      <text>消息通知</text>
      <text class="arrow">></text>
    </view>
    <view class="setting-item" bindtap="navigateToSettings" data-type="feedback">
      <text>反馈</text>
      <text class="arrow">></text>
    </view>
    <view class="setting-item" bindtap="navigateToSettings" data-type="about">
      <text>关于我们</text>
      <text class="arrow">></text>
    </view>
  </view>

  <!-- 登录模态框 - 使用原生组件 -->
  <view class="modal-mask" wx:if="{{showLoginModal}}" bindtap="closeLoginModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">账号登录</text>
        <text class="modal-close" bindtap="closeLoginModal">×</text>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">用户名</text>
          <input class="form-input" 
                 placeholder="请输入用户名" 
                 value="{{username}}" 
                 bindinput="inputUsername"
                 disable-default-padding="{{true}}"
                 auto-focus="{{false}}" />
        </view>
        <view class="form-item">
          <text class="form-label">密码</text>
          <input class="form-input" 
                 password 
                 placeholder="请输入密码" 
                 value="{{password}}" 
                 bindinput="inputPassword"
                 disable-default-padding="{{true}}"
                 auto-focus="{{false}}" />
        </view>
        <view class="register-link">
          <text>没有账号？</text>
          <text class="link-text" bindtap="showRegister">立即注册</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-button" type="default" bindtap="closeLoginModal">取消</button>
        <button class="modal-button" type="primary" bindtap="handleAccountLogin">登录</button>
      </view>
    </view>
  </view>

  <!-- 注册模态框 - 使用原生组件 -->
  <view class="modal-mask" wx:if="{{showRegisterModal}}" bindtap="closeRegisterModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">注册账号</text>
        <text class="modal-close" bindtap="closeRegisterModal">×</text>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">用户名</text>
          <input class="form-input" 
                 placeholder="请输入用户名" 
                 value="{{registerUsername}}" 
                 bindinput="inputRegisterUsername"
                 disable-default-padding="{{true}}"
                 auto-focus="{{false}}" />
        </view>
        <view class="form-item">
          <text class="form-label">密码</text>
          <input class="form-input" 
                 password 
                 placeholder="请输入密码(至少8位，包含字母和数字)" 
                 value="{{registerPassword}}" 
                 bindinput="inputRegisterPassword"
                 disable-default-padding="{{true}}"
                 auto-focus="{{false}}" />
          <!-- 添加密码强度提示 -->
          <text class="password-tip {{passwordTip.includes('强') ? 'strong' : 'weak'}}">{{passwordTip}}</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-button" type="default" bindtap="closeRegisterModal">取消</button>
        <button class="modal-button" type="primary" bindtap="handleRegister">注册</button>
      </view>
    </view>
  </view>
</view>