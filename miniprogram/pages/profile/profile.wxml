<!--pages/profile/profile.wxml-->
<view class="container">
  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{loading}}">
    <text class="loading-text">加载中...</text>
  </view>
  
  <!-- 未登录状态 -->
  <view class="no-login" wx:elif="{{!isLoggedIn}}">
    <text class="no-login-text">请先登录查看个人资料</text>
  </view>
  
  <!-- 用户信息内容 -->
  <view class="profile-content" wx:else>
    <!-- 用户头像和基本信息 -->
    <view class="profile-header">
      <image class="avatar" src="{{userInfo.avatarUrl || 'https://example.com/default-avatar.jpg'}}" mode="aspectFill" />
      <view class="user-basic">
        <text class="username">{{userInfo.username || '未设置'}}</text>
        <text class="user-level">{{userInfo.level || 'beginner'}}</text>
      </view>
      <button class="edit-btn" size="mini" type="primary" plain bindtap="editProfile">编辑</button>
    </view>
    
    <!-- 个人详细信息 -->
    <view class="info-section">
      <text class="section-title">个人信息</text>
      
      <view class="info-item">
        <text class="info-label">性别</text>
        <text class="info-value">
          {{userInfo.gender !== null && userInfo.gender !== undefined ? 
            (userInfo.gender === 0 ? '未知' : (userInfo.gender === 1 ? '男' : '女')) : 
            '未设置'}}
        </text>
      </view>
      
      <view class="info-item">
        <text class="info-label">年龄</text>
        <text class="info-value">
          {{userInfo.age ? userInfo.age + '岁' : '未设置'}}
        </text>
      </view>
      
      <view class="info-item">
        <text class="info-label">身高</text>
        <text class="info-value">
          {{userInfo.height ? userInfo.height + 'cm' : '未设置'}}
        </text>
      </view>
      
      <view class="info-item">
        <text class="info-label">体重</text>
        <text class="info-value">
          {{userInfo.weight ? userInfo.weight + 'kg' : '未设置'}}
        </text>
      </view>
    </view>
    
    <!-- 运动统计信息 -->
    <view class="stats-section">
      <text class="section-title">运动统计</text>
      
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-value">{{userInfo.total_workouts || 0}}</text>
          <text class="stat-label">总运动次数</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{userInfo.total_duration || 0}}</text>
          <text class="stat-label">总时长(分钟)</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{userInfo.total_distance || 0}}</text>
          <text class="stat-label">总距离(km)</text>
        </view>
      </view>
    </view>
    
    <!-- 账户信息 -->
    <view class="account-section">
      <text class="section-title">账户信息</text>
      
      <view class="info-item">
        <text class="info-label">用户ID</text>
        <text class="info-value">{{userInfo.id}}</text>
      </view>
      
      <view class="info-item">
        <text class="info-label">注册时间</text>
        <text class="info-value">
          {{userInfo.created_at ? userInfo.created_at : '未知'}}
        </text>
      </view>
      
      <view class="info-item">
        <text class="info-label">最后更新</text>
        <text class="info-value">
          {{userInfo.updated_at ? userInfo.updated_at : '未知'}}
        </text>
      </view>
    </view>
  </view>
  
  <!-- 编辑用户信息模态框 -->
  <view class="modal-mask" wx:if="{{showEditModal}}" bindtap="closeEditModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">编辑个人信息</text>
        <text class="modal-close" bindtap="closeEditModal">×</text>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">性别</text>
          <picker class="form-picker" 
                  mode="selector" 
                  range="{{genderOptions}}" 
                  range-key="label"
                  value="{{editForm.gender}}" 
                  bindchange="onGenderChange">
            <view class="picker-content">{{genderOptions[editForm.gender].label}}</view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">年龄</text>
          <input class="form-input" 
                 type="number"
                 placeholder="请输入年龄(1-120)" 
                 value="{{editForm.age}}" 
                 bindinput="onAgeInput"
                 maxlength="3" />
        </view>
        
        <view class="form-item">
          <text class="form-label">身高 (cm)</text>
          <input class="form-input" 
                 type="digit"
                 placeholder="请输入身高(50-250cm)" 
                 value="{{editForm.height}}" 
                 bindinput="onHeightInput"
                 maxlength="6" />
        </view>
        
        <view class="form-item">
          <text class="form-label">体重 (kg)</text>
          <input class="form-input" 
                 type="digit"
                 placeholder="请输入体重(10-500kg)" 
                 value="{{editForm.weight}}" 
                 bindinput="onWeightInput"
                 maxlength="6" />
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="modal-button" type="default" bindtap="closeEditModal">取消</button>
        <button class="modal-button" type="primary" bindtap="saveProfile">保存</button>
      </view>
    </view>
  </view>
</view> 